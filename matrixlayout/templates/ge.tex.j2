% -----------------------------------------------------------------------------
% GE template (layout-only)
% Target: current nicematrix (CodeBefore/Body/CodeAfter + \SubMatrix syntax)
% -----------------------------------------------------------------------------
\documentclass[notitlepage]{article}
\pagestyle{empty}
% NOTE: Large page + generous margins prevent TikZ callouts (e.g., delimiter arrows/labels)
% from being clipped at negative coordinates before tight-cropping.
\usepackage[left=50mm,right=50mm,top=50mm,bottom=50mm,paperwidth=90in,paperheight=90in]{geometry}

\usepackage{mathtools}
\usepackage{graphicx}
\usepackage[table,svgnames]{xcolor}

\usepackage{nicematrix,tikz}
\usetikzlibrary{calc,fit,decorations.markings,arrows.meta}

% Convenience shorthands for user-supplied TikZ.
% Many notebook users naturally write `node[west]` (meaning anchor=west). TikZ
% does not define these keys by default, so we provide them as styles.
\tikzset{
  west/.style={anchor=west},
  east/.style={anchor=east},
  north/.style={anchor=north},
  south/.style={anchor=south},
  northwest/.style={anchor=north west},
  northeast/.style={anchor=north east},
  southwest/.style={anchor=south west},
  southeast/.style={anchor=south east},
}

% nicematrix provides \NotEmpty in modern releases. We use it in generated
% matrices to ensure cell nodes exist without introducing visible spacing.
% Provide a harmless fallback for older nicematrix versions.
\providecommand\NotEmpty{\kern0pt}

{%% if landscape %%}
\usepackage{pdflscape}
{%% endif %%}

\newcommand*{\colorboxed}{}
\def\colorboxed#1#{%
  \colorboxedAux{#1}%
}
\newcommand*{\colorboxedAux}[3]{%
  \begingroup
    \colorlet{cb@saved}{.}%
    \color#1{#2}%
    \boxed{%
      \color{cb@saved}%
      #3%
    }%
  \endgroup
}

{{ extension }}

\begin{document}\begin{minipage}{\textwidth}%
{%% if landscape %%}\begin{landscape}%{%% endif %%}%
{%% if fig_scale_open %%}{{ fig_scale_open }}%{%% endif %%}%
{{ preamble }}%
$% begin math
\begin{NiceArray}{%% if nice_options %%}[{{- nice_options -}}]{%% endif %%}{ {{- mat_format -}} }% begin NiceArray
\CodeBefore{%% if create_cell_nodes %%}[create-cell-nodes]{%% endif %%}% 
{%%- for entry in codebefore -%%}{{ entry }}%{%%- endfor -%%}%
\Body%
{{ mat_rep }}%
{%%- set has_after = (submatrix_spans|length > 0) or (submatrix_names|length > 0) or (pivot_locs|length > 0) or (txt_with_locs|length > 0) or (rowechelon_paths|length > 0) -%%}%
{%% if has_after %%}%
\CodeAfter%
% ----- \SubMatrix delimiters%
{%%- for item in submatrix_spans -%%}%
{%%- set opts = item[0] -%%}%
{%%- set span = item[1] -%%}%
\SubMatrix({{ span }}){%% if opts %%}[{{ opts }}]{%% endif %%}{%% if item|length > 2 %%}_{ {{- item[2] -}}}^{ {{- item[3] -}}}{%% endif %%}%
{%%- endfor -%%}%
% ----- Labels / names%
{%%- for txt in submatrix_names -%%}%
{{ txt }}%
{%%- endfor -%%}%
% ----- TikZ decorations%
{%%- if (pivot_locs|length > 0) or (txt_with_locs|length > 0) or (rowechelon_paths|length > 0) -%%}%
\begin{tikzpicture}%
\begin{scope}[every node/.style = draw]%
{%%- for fit_target, extra_style in pivot_locs -%%}%
\node[draw{%% if extra_style %%},{{ extra_style }}{%% endif %%},fit={{ fit_target }}] {};%
{%%- endfor -%%}%
\end{scope}%
{%%- for coord, txt, style in txt_with_locs -%%}%
\node[{%% if style %%}{{ style }}{%% endif %%}] at {{ coord }} { {{ txt }} };%
{%%- endfor -%%}%
{%%- for p in rowechelon_paths -%%}%
{{ p }}%
{%%- endfor -%%}%
\end{tikzpicture}%
{%%- endif -%%}%
{%% endif %%}%
\end{NiceArray}% end NiceArray
$% end math
{%% if fig_scale_close %%}{{ fig_scale_close }}%{%% endif %%}%
{%% if landscape %%}\end{landscape}%{%% endif %%}%
\end{minipage}\end{document}
